{% extends "turnos/base_turnos.html" %}
{% block content %}

<div class="card shadow-sm border-0 rounded-4">
  <div class="card-body p-4 p-md-5">

    <div class="d-flex align-items-center justify-content-between gap-3 mb-3">
      <div>
        <span class="badge rounded-pill text-bg-primary">Paso 6 de 6</span>
      </div>
      <div class="d-flex gap-2">
        <a href="{% url 'turnos:paso5_hora' %}" class="btn btn-sm btn-outline-light">Volver</a>
        <a href="{% url 'turnos:cancelar' %}" class="btn btn-sm btn-outline-light">Cancelar Turno</a>
      </div>
    </div>

    {% if messages %}
      {% for message in messages %}
        <div class="alert alert-{{ message.tags }} rounded-4 py-2 mb-3">
          {{ message }}
        </div>
      {% endfor %}
    {% endif %}

    <h2 class="fw-black mb-3">Turno seleccionado</h2>

    <div class="p-3 p-md-4 rounded-4 bg-white border">
      <div class="d-flex flex-wrap align-items-center justify-content-between gap-2">
        <div class="text-success fw-bold fs-5">{{ motivo.nombre }}</div>

        {# precio visible arriba también #}
        <div class="text-end">
          <div class="small text-muted">Precio</div>
          <div class="fw-black fs-5">${{ precio }}</div>
        </div>
      </div>

      <hr class="my-3">

      <div class="row g-3">
        <div class="col-12 col-md-6">
          <div class="small text-muted">Fecha</div>
          <div class="fw-semibold">{{ fecha|date:"l d \\d\\e F \\d\\e Y" }}</div>
        </div>

        <div class="col-12 col-md-6">
          <div class="small text-muted">Hora</div>
          <div class="fw-semibold">{{ hora|time:"H:i" }} hs</div>
        </div>

        <div class="col-12 col-md-6">
          <div class="small text-muted">DNI/CUIL</div>
          <div class="fw-semibold">{{ dni }}</div>
        </div>

        {% if oficina %}
        <div class="col-12 col-md-6">
          <div class="small text-muted">Oficina</div>
          <div class="fw-semibold">{{ oficina.nombre }}</div>
          <div class="text-muted small">{{ oficina.direccion }}{% if oficina.ciudad %} - {{ oficina.ciudad }}{% endif %}</div>
        </div>
        {% endif %}
      </div>
    </div>

    <div class="mt-4 p-3 rounded-4 border bg-light d-flex flex-wrap align-items-center justify-content-between gap-3">
      <div>
        <div class="small text-muted">Total a pagar</div>
        <div class="fw-black fs-4 mb-0">${{ precio }}</div>
        <div class="text-muted small">Serás redirigido a Mercado Pago para completar el pago.</div>
      </div>

      {% load static %}

      <form method="post" action="{% url 'turnos:mp_checkout' %}" class="m-0">
        {% csrf_token %}

        <button type="submit" class="btn border-0 bg-transparent px-3 py-2">
          <img src="{% static 'img/mercadopago.webp' %}"
              alt="Pagar con Mercado Pago"
              style="height:80px; width:auto; border-radius:12px;">
        </button>
      </form>

    </div>

  </div>
</div>

{% endblock %}
